import { User } from '../types';

// Indian male bot users
const indianMaleBots: User[] = [
  { id: 'bot-m1', username: 'Arjun', gender: 'male', age: 23, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Arjun' },
  { id: 'bot-m2', username: 'Rahul', gender: 'male', age: 25, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Rahul' },
  { id: 'bot-m3', username: 'Vikram', gender: 'male', age: 21, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Vikram' },
  { id: 'bot-m4', username: 'Aditya', gender: 'male', age: 24, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Aditya' },
  { id: 'bot-m5', username: 'Rohan', gender: 'male', age: 22, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Rohan' },
  { id: 'bot-m6', username: 'Karan', gender: 'male', age: 26, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Karan' },
  { id: 'bot-m7', username: 'Nikhil', gender: 'male', age: 20, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Nikhil' },
  { id: 'bot-m8', username: 'Varun', gender: 'male', age: 27, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Varun' },
  { id: 'bot-m9', username: 'Raj', gender: 'male', age: 23, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Raj' },
  { id: 'bot-m10', username: 'Amit', gender: 'male', age: 25, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Amit' },
  { id: 'bot-m11', username: 'Sanjay', gender: 'male', age: 24, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Sanjay' },
  { id: 'bot-m12', username: 'Deepak', gender: 'male', age: 22, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Deepak' },
  { id: 'bot-m13', username: 'Ajay', gender: 'male', age: 26, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Ajay' },
  { id: 'bot-m14', username: 'Vijay', gender: 'male', age: 21, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Vijay' },
  { id: 'bot-m15', username: 'Ravi', gender: 'male', age: 25, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Ravi' }
];

// Indian female bot users
const indianFemaleBots: User[] = [
  { id: 'bot-f1', username: 'Priya', gender: 'female', age: 22, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Priya' },
  { id: 'bot-f2', username: 'Neha', gender: 'female', age: 24, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Neha' },
  { id: 'bot-f3', username: 'Anjali', gender: 'female', age: 21, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Anjali' },
  { id: 'bot-f4', username: 'Pooja', gender: 'female', age: 23, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Pooja' },
  { id: 'bot-f5', username: 'Riya', gender: 'female', age: 20, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Riya' },
  { id: 'bot-f6', username: 'Shreya', gender: 'female', age: 25, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Shreya' },
  { id: 'bot-f7', username: 'Divya', gender: 'female', age: 22, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Divya' },
  { id: 'bot-f8', username: 'Aisha', gender: 'female', age: 24, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Aisha' },
  { id: 'bot-f9', username: 'Meera', gender: 'female', age: 21, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Meera' },
  { id: 'bot-f10', username: 'Kavya', gender: 'female', age: 23, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Kavya' },
  { id: 'bot-f11', username: 'Ananya', gender: 'female', age: 20, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Ananya' },
  { id: 'bot-f12', username: 'Sakshi', gender: 'female', age: 25, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Sakshi' },
  { id: 'bot-f13', username: 'Nisha', gender: 'female', age: 22, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Nisha' },
  { id: 'bot-f14', username: 'Tanvi', gender: 'female', age: 24, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Tanvi' },
  { id: 'bot-f15', username: 'Zara', gender: 'female', age: 21, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Zara' },
  { id: 'bot-f16', username: 'Sonia', gender: 'female', age: 23, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Sonia' },
  { id: 'bot-f17', username: 'Isha', gender: 'female', age: 20, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Isha' },
  { id: 'bot-f18', username: 'Kritika', gender: 'female', age: 25, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Kritika' },
  { id: 'bot-f19', username: 'Aditi', gender: 'female', age: 22, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Aditi' },
  { id: 'bot-f20', username: 'Rhea', gender: 'female', age: 24, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Rhea' }
];

// Foreign female bot users
const foreignFemaleBots: User[] = [
  { id: 'bot-ff1', username: 'Emma', gender: 'female', age: 23, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Emma' },
  { id: 'bot-ff2', username: 'Sophia', gender: 'female', age: 25, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Sophia' },
  { id: 'bot-ff3', username: 'Isabella', gender: 'female', age: 22, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Isabella' },
  { id: 'bot-ff4', username: 'Olivia', gender: 'female', age: 24, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Olivia' },
  { id: 'bot-ff5', username: 'Mia', gender: 'female', age: 21, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Mia' },
  { id: 'bot-ff6', username: 'Ava', gender: 'female', age: 23, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Ava' },
  { id: 'bot-ff7', username: 'Emily', gender: 'female', age: 25, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Emily' },
  { id: 'bot-ff8', username: 'Charlotte', gender: 'female', age: 22, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Charlotte' },
  { id: 'bot-ff9', username: 'Amelia', gender: 'female', age: 24, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Amelia' },
  { id: 'bot-ff10', username: 'Luna', gender: 'female', age: 21, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Luna' }
];

// American male bot users
const americanMaleBots: User[] = [
  { id: 'bot-am1', username: 'James', gender: 'male', age: 24, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=James' },
  { id: 'bot-am2', username: 'William', gender: 'male', age: 26, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=William' },
  { id: 'bot-am3', username: 'Benjamin', gender: 'male', age: 23, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Benjamin' },
  { id: 'bot-am4', username: 'Lucas', gender: 'male', age: 25, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Lucas' },
  { id: 'bot-am5', username: 'Henry', gender: 'male', age: 22, isOnline: true, avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Henry' }
];

// Enhanced bot responses with more context and variety
const botResponses = {
  greetings: [
    'Hey! How are you?',
    'Hi there! Nice to meet you!',
    'Hello! How\'s your day going?',
    'Hey! What\'s up?',
    'Hi! How are you doing today?',
    'Hello! Great to see you here!',
    'Hi! Thanks for messaging me!'
  ],
  generic: [
    'That\'s interesting! Tell me more.',
    'I\'d love to hear more about that!',
    'That sounds fascinating!',
    'That\'s really cool! What else?',
    'Wow, that\'s great to know!',
    'I understand what you mean.',
    'That makes a lot of sense.',
    'How interesting! And then what happened?',
    'That\'s amazing! How do you feel about it?',
    'I totally get what you\'re saying!'
  ],
  questions: [
    'What do you like to do for fun?',
    'What are your favorite hobbies?',
    'Where are you from? I\'d love to know!',
    'What kind of music gets you moving?',
    'Have you traveled anywhere exciting lately?',
    'What\'s your favorite type of food?',
    'Seen any good movies or shows recently?',
    'What do you do for work? Is it something you enjoy?',
    'How did you discover ChatSafari?',
    'What interests you the most in life?'
  ],
  positive: [
    'That\'s wonderful to hear!',
    'I\'m so glad you shared that!',
    'That sounds amazing!',
    'How exciting!',
    'That must be really great!'
  ],
  empathy: [
    'I understand how you feel.',
    'That must be quite an experience.',
    'Thanks for sharing that with me.',
    'I appreciate you telling me about this.',
    'That\'s a really interesting perspective.'
  ],
  followUp: [
    'What happened next?',
    'How did that make you feel?',
    'Tell me more about that!',
    'What do you think about that?',
    'That\'s fascinating, please continue!'
  ]
};

interface BotContext {
  lastMessage: string;
  messageCount: number;
  topics: Set<string>;
  name: string;
  location: string;
  interests: Set<string>;
  college: string;
  hobbies: Set<string>;
  clothingAsked: boolean;
}

// Store conversation context for each bot
const conversationContext = new Map<string, BotContext>();

// Function to analyze message content for topics
const extractTopics = (message: string): string[] => {
  const topics = new Set<string>();
  const lowercaseMsg = message.toLowerCase();
  
  // Common topics to track
  const topicKeywords = {
    music: ['music', 'song', 'singer', 'band', 'concert'],
    movies: ['movie', 'film', 'cinema', 'watch', 'netflix'],
    travel: ['travel', 'trip', 'vacation', 'visit', 'country'],
    food: ['food', 'eat', 'restaurant', 'cooking', 'dish'],
    work: ['work', 'job', 'career', 'office', 'business'],
    hobbies: ['hobby', 'interest', 'passion', 'free time', 'weekend'],
    sports: ['sport', 'game', 'team', 'play', 'match']
  };

  Object.entries(topicKeywords).forEach(([topic, keywords]) => {
    if (keywords.some(keyword => lowercaseMsg.includes(keyword))) {
      topics.add(topic);
    }
  });

  return Array.from(topics);
};

// Function to get a random response
const getRandomResponse = (type: keyof typeof botResponses): string => {
  const responses = botResponses[type];
  return responses[Math.floor(Math.random() * responses.length)];
};

// Enhanced bot response generation with context awareness
export const generateBotResponse = (message: string, botId: string): string => {
  const bot = allBotUsers.find(bot => bot.id === botId);
  if (!bot) return "Hey";

  // Get or initialize context for this bot
  let context = conversationContext.get(botId);
  if (!context) {
    context = {
      lastMessage: '',
      messageCount: 0,
      topics: new Set<string>(),
      name: '',
      location: '',
      interests: new Set<string>(),
      college: '',
      hobbies: new Set<string>(),
      clothingAsked: false
    };
    conversationContext.set(botId, context);
  }

  // Update context
  context.lastMessage = message;
  context.messageCount++;
  const lowercaseMsg = message.toLowerCase();

  // Simple greetings with single words
  if (/^(hi|hey|hello|howdy|greetings)$/i.test(message.trim())) {
    const responses = ["Hey", "Hi", "Hello"];
    return responses[Math.floor(Math.random() * responses.length)];
  }

  // Age responses
  if (lowercaseMsg.includes("age") || 
      lowercaseMsg.includes("how old") || 
      lowercaseMsg.includes("umar") || 
      lowercaseMsg.includes("tumhari age")) {
    const age = Math.floor(Math.random() * (27 - 17 + 1)) + 17;
    return age.toString();
  }

  // Location responses
  if (lowercaseMsg.includes("kha se ho") || 
      lowercaseMsg.includes("kha rhti ho") || 
      lowercaseMsg.includes("where") && (lowercaseMsg.includes("from") || lowercaseMsg.includes("live")) || 
      lowercaseMsg.includes("u from")) {
    const cities = ["Mumbai", "Delhi", "Bangalore", "Pune", "Chennai", "Hyderabad", "Kolkata"];
    const randomCity = cities[Math.floor(Math.random() * cities.length)];
    context.location = randomCity;
    return randomCity;
  }

  // Clothing responses
  if (lowercaseMsg.includes("wearing") || 
      lowercaseMsg.includes("pehna") || 
      lowercaseMsg.includes("pehni") || 
      lowercaseMsg.includes("dress")) {
    if (!context.clothingAsked) {
      context.clothingAsked = true;
      return "3 clothes... guess karo kya pehna hai";
    } else {
      return "Haha try to guess";
    }
  }

  // Study/Education responses
  if (lowercaseMsg.includes("study") || 
      lowercaseMsg.includes("padhai") || 
      lowercaseMsg.includes("course") || 
      lowercaseMsg.includes("college") || 
      lowercaseMsg.includes("university")) {
    const courses = [
      "B.Tech Computer Science",
      "BBA",
      "B.Com",
      "BA Psychology",
      "BSc Mathematics",
      "BA English Literature",
      "BCA",
      "BSc Physics",
      "Hotel Management",
      "Fashion Designing"
    ];
    if (!context.college) {
      context.college = courses[Math.floor(Math.random() * courses.length)];
    }
    return context.college;
  }

  // Name sharing responses
  if (lowercaseMsg.includes("i'm ") || lowercaseMsg.includes("im ") || lowercaseMsg.includes("my name")) {
    const nameMatch = message.match(/(?:I'm|Im|i'm|im|my name is)\s+(\w+)/i);
    if (nameMatch) {
      context.name = nameMatch[1];
      return `Hi ${nameMatch[1]}`;
    }
  }

  // For longer messages
  if (message.length > 50) {
    const responses = [
      "Hmm",
      "Okay",
      "I see",
      "Right"
    ];
    return responses[Math.floor(Math.random() * responses.length)];
  }

  // Default responses
  const defaultResponses = [
    "Hmm",
    "Ok",
    "Acha",
    "Haan",
    "Tell me",
    "Batao"
  ];

  return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
};

// Function to clear conversation context
export const clearBotContext = (botId: string): void => {
  conversationContext.delete(botId);
};

// Combine all bot users
export const allBotUsers: User[] = [
  ...indianMaleBots,
  ...indianFemaleBots,
  ...foreignFemaleBots,
  ...americanMaleBots
];

// Function to get random online status for bots
const getRandomOnlineStatus = (): boolean => {
  // Higher probability of being online (90% chance)
  return Math.random() > 0.1;
};

// Function to update bot users' online status
export const updateBotUsersStatus = (): User[] => {
  // Bots are always present and online
  return allBotUsers.map(user => ({
    ...user,
    isOnline: true,
    lastSeen: new Date().toISOString(),
    isBot: true
  }));
}; 